<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:composition template="/WEB-INF/templates/default.xhtml">
	<ui:define name="content">
		<div class="section no-pad-top">
			<div class="section #{style.colorPrimaryBase}">
				<h1 class="header center #{style.textColorPrimary}">Poll
					Management</h1>
			</div>
			<br />

			<div class="container">
				<div class="row">
					<div class="col s6">
						<h:form id="enabledPollSelector">
							<h:selectOneMenu value="#{ManagerController.enabledPoll}"
								converter="#{PollConverter}">
								<f:selectItem itemValue="#{null}"
									itemLabel="-- No Polls Enabled --" noSelectionOption="true" />
								<f:selectItems value="#{ManagerController.polls}" var="poll"
									itemLabel="#{poll.name}" itemValue="#{poll}" />
								<label>Enabled Poll</label>
								<f:ajax listener="#{ManagerController.onEnabledPollChanged}" />
							</h:selectOneMenu>
						</h:form>
					</div>
				</div>

				<h:panelGroup id="navBar">
					<nav class="light-blue darken-4">
					<div class="nav-wrapper">
						<h:form>
							<ul id="nav-mobile" class="left hide-on-med-and-down">
								<ui:repeat value="#{ManagerController.polls}" var="poll">
									<li
										class="#{poll.id == ManagerController.selectedPoll.id ? 'active' : ''}">
										<h:commandLink value="#{poll.name}"
											action="#{ManagerController.setSelectedPoll(poll)}">
											<f:ajax render=":pollContent :navBar" />
										</h:commandLink>
									</li>
								</ui:repeat>
								<li>
									<h:commandLink action="#{ManagerController.addNewPoll()}">
										<i class="material-icons">add</i>
										<f:ajax render=":pollContent :navBar :enabledPollSelector"
											onevent="refreshEnabledPollSelector" />
									</h:commandLink>
								</li>
							</ul>
						</h:form>
					</div>
					</nav>
				</h:panelGroup>

				<br />

				<h:panelGroup id="pollContent">
					<ui:fragment rendered="#{ManagerController.selectedPoll != null}">
						<div class="row">
							<div class="col s12">
								<h:form>
									<h:commandLink value="Delete Poll"
										styleClass="waves-effect waves-light btn #{style.colorDelete}"
										action="#{ManagerController.deleteSelectedPoll()}">
										<i class="material-icons right">delete</i>
										<f:ajax render=":pollContent :navBar :enabledPollSelector"
											onevent="refreshEnabledPollSelector" />
									</h:commandLink>
								</h:form>
							</div>
						</div>
						<div class="row">
							<div class="col s6">
								<div class="card">
									<h:form id="nameForm">
										<div class="card-content">
											<span class="card-title">Poll Name:</span>

											<ui:fragment rendered="#{!ManagerController.editingName}">
												<br />
												<h:outputText value="#{ManagerController.editablePollName}" />
											</ui:fragment>
											<ui:fragment rendered="#{ManagerController.editingName}">
												<div class="input-field">
													<h:inputText id="nameTextField"
														value="#{ManagerController.editablePollName}" />
												</div>
											</ui:fragment>
										</div>
										<div class="card-action">
											<ui:fragment rendered="#{!ManagerController.editingName}">
												<h:commandLink class="#{style.colorPrimaryText}">
													<i class="material-icons">mode_edit</i>
													<f:ajax render=":nameForm"
														listener="#{ManagerController.onEditNameButtonFired}" />
												</h:commandLink>
											</ui:fragment>
											<ui:fragment rendered="#{ManagerController.editingName}">
												<h:commandLink class="#{style.colorPrimaryText}">
													<i class="material-icons">done</i>
													<f:ajax execute="nameTextField"
														render=":nameForm :navBar :enabledPollSelector"
														listener="#{ManagerController.onEditNameDoneButtonFired}"
														onevent="refreshEnabledPollSelector" />
												</h:commandLink>
											</ui:fragment>
											<h:message for="nameForm" style="color: red" />
										</div>
									</h:form>
								</div>
							</div>
							<div class="col s6">
								<div class="card">
									<h:form id="descriptionForm">
										<div class="card-content">
											<span class="card-title">Poll Description:</span>

											<ui:fragment
												rendered="#{!ManagerController.editingDescription}">
												<br />
												<h:outputText
													value="#{ManagerController.editablePollDescription}" />
											</ui:fragment>
											<ui:fragment
												rendered="#{ManagerController.editingDescription}">
												<div class="input-field">
													<h:inputTextarea id="descriptionTextarea"
														styleClass="materialize-textarea"
														style="padding-top: 0; margin-bottom: 0;"
														value="#{ManagerController.editablePollDescription}" />
												</div>
											</ui:fragment>
										</div>
										<div class="card-action">
											<ui:fragment
												rendered="#{!ManagerController.editingDescription}">
												<h:commandLink class="#{style.colorPrimaryText}">
													<i class="material-icons">mode_edit</i>
													<f:ajax render=":descriptionForm"
														listener="#{ManagerController.onEditDescriptionButtonFired}" />
												</h:commandLink>
											</ui:fragment>
											<ui:fragment
												rendered="#{ManagerController.editingDescription}">
												<h:commandLink class="#{style.colorPrimaryText}">
													<i class="material-icons">done</i>
													<f:ajax execute="descriptionTextarea"
														render=":descriptionForm"
														listener="#{ManagerController.onEditDescriptionDoneButtonFired}" />
												</h:commandLink>
											</ui:fragment>
											<h:message for="descriptionForm" style="color: red" />
										</div>
									</h:form>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col s12">
								<span style="font-size: 24px; font-weight: 300">Vote
									Groups: </span>
								<table class="striped responsive-table">
									<thead>
										<tr>
											<th>Talent</th>
											<th>Contestants</th>
										</tr>
									</thead>
									<tbody>
										<ui:repeat
											value="#{ManagerController.selectedPoll.voteGroups}"
											var="voteGroup">
											<tr>
												<td>#{voteGroup.talentName == null ? 'No Talent' :
													voteGroup.talentName}</td>
												<td>
													<ui:repeat value="#{voteGroup.contestants}"
														var="contestant" varStatus="status">
													#{contestant.firstName} #{contestant.lastName}#{status.last ? '' : ','}
												</ui:repeat>
												</td>
												<td>
													<h:form>
														<h:link
															outcome="modifyVoteGroup?voteGroupId=#{voteGroup.id}"
															includeViewParams="true">
															<i class="material-icons">mode_edit</i>
														</h:link>
													</h:form>
												</td>
												<td>
													<h:form>
														<h:commandLink class="#{style.colorDeleteText}"
															action="#{ManagerController.deleteVoteGroup(voteGroup)}">
															<i class="material-icons">delete</i>
															<f:ajax render=":pollContent" />
														</h:commandLink>
													</h:form>
												</td>
											</tr>
										</ui:repeat>
									</tbody>
								</table>
								<h:form>
									<h:commandLink action="#{ManagerController.addNewVoteGroup()}">
										<i class="material-icons">add</i>
										<f:ajax render=":pollContent" />
									</h:commandLink>
								</h:form>
							</div>
						</div>
					</ui:fragment>
				</h:panelGroup>
			</div>
		</div>

	</ui:define>
	<ui:define name="javascript">
		<script type="text/javascript">
			$(document).ready(function() {
				$('select').material_select();
			});

			function refreshEnabledPollSelector(data) {
				if (data.status === 'success') {
					$('select').material_select();
				}
			}
		</script>
	</ui:define>
</ui:composition>
</html>
