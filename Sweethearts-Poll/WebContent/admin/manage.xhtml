<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:composition template="/WEB-INF/templates/default.xhtml">
	<ui:define name="content">
		<div class="section no-pad-bot" id="index-banner">
			<div class="container">

				<div class="row">
					<div class="col s6">
						<h:form id="enabledPollSelector">
							<h:selectOneMenu value="#{ManagerController.enabledPoll}"
								converter="#{PollConverter}">
								<f:selectItem itemValue="#{null}"
									itemLabel="-- No Polls Enabled --" noSelectionOption="true" />
								<f:selectItems value="#{ManagerController.polls}" var="poll"
									itemLabel="#{poll.name}" itemValue="#{poll}" />
								<label>Enabled Poll</label>
								<f:ajax listener="#{ManagerController.onEnabledPollChanged}" />
							</h:selectOneMenu>
						</h:form>
					</div>
				</div>

				<h:panelGroup id="navBar">
					<nav class="light-blue darken-4">
					<div class="nav-wrapper">
						<h:form>
							<ul id="nav-mobile" class="left hide-on-med-and-down">
								<ui:repeat value="#{ManagerController.polls}" var="poll">
									<li
										class="#{poll.id == ManagerController.selectedPoll.id ? 'active' : ''}">
										<h:commandLink value="#{poll.name}"
											action="#{ManagerController.setSelectedPoll(poll)}">
											<f:ajax render=":pollContent :navBar" />
										</h:commandLink>
									</li>
								</ui:repeat>
							</ul>
							<h:commandLink styleClass="right" style="padding:0 20px"
								value="Add Dummy Polls"
								action="#{ManagerController.addDummyPolls()}" />
						</h:form>
					</div>
					</nav>
				</h:panelGroup>

				<br />

				<h:panelGroup rendered="#{ManagerController.selectedPoll != null}"
					layout="block" id="pollContent">
					<div class="row">
						<div class="col s6">
							<div class="card">
								<h:form id="descriptionForm">
									<div class="card-content">
										<span class="card-title">Poll Description:</span>

										<ui:fragment
											rendered="#{!ManagerController.editingDescription}">
											<br />
											<h:outputText
												value="#{ManagerController.selectedPoll.description}" />
										</ui:fragment>
										<ui:fragment
											rendered="#{ManagerController.editingDescription}">
											<h:inputTextarea id="descriptionTextarea"
												value="#{ManagerController.selectedPoll.description}" />
										</ui:fragment>
									</div>
									<div class="card-action">
										<ui:fragment
											rendered="#{!ManagerController.editingDescription}">
											<h:commandLink class="#{style.colorPrimaryText}">
												<i class="material-icons">mode_edit</i>
												<f:ajax render=":descriptionForm"
													listener="#{ManagerController.onEditDescriptionButtonFired}" />
											</h:commandLink>
										</ui:fragment>
										<ui:fragment
											rendered="#{ManagerController.editingDescription}">
											<h:commandLink class="#{style.colorPrimaryText}">
												<i class="material-icons">done</i>
												<f:ajax execute="descriptionTextarea"
													render=":descriptionForm"
													listener="#{ManagerController.onEditDescriptionDoneButtonFired}" />
											</h:commandLink>
										</ui:fragment>
									</div>
								</h:form>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col s12">
							<span style="font-size: 24px; font-weight: 300">Vote
								Groups: </span>
							<table class="striped responsive-table">
								<thead>
									<tr>
										<th>Talent</th>
										<th>Contestants</th>
									</tr>
								</thead>
								<tbody>
									<ui:repeat value="#{ManagerController.selectedPoll.voteGroups}"
										var="voteGroup">
										<tr>
											<td>#{voteGroup.talentName == null ? 'No Talent' :
												voteGroup.talentName}</td>
											<td>
												<ui:repeat value="#{voteGroup.contestants}" var="contestant"
													varStatus="status">
													#{contestant.firstName} #{contestant.lastName}#{status.last ? '' : ','}
												</ui:repeat>
											</td>
											<td>
												<h:form>
													<h:link outcome="modifyVoteGroup?voteGroupId=#{voteGroup.id}" includeViewParams="true">
														<i class="material-icons">mode_edit</i>
													</h:link>
												</h:form>
											</td>
											<td>
												<h:form>
													<h:commandLink class="#{style.colorDelete}"
														action="#{ManagerController.deleteVoteGroup(voteGroup)}">
														<i class="material-icons">delete</i>
														<f:ajax render=":pollContent" />
													</h:commandLink>
												</h:form>
											</td>
										</tr>
									</ui:repeat>
								</tbody>
							</table>
							<h:form>
								<h:commandLink action="#{ManagerController.addNewVoteGroup()}">
									<i class="material-icons">add</i>
									<f:ajax render=":pollContent" />
								</h:commandLink>
							</h:form>
						</div>
					</div>
				</h:panelGroup>
			</div>
		</div>

	</ui:define>
	<ui:define name="javascript">
		<script type="text/javascript">
			$(document).ready(function() {
				$('select').material_select();
			});
		</script>
	</ui:define>
</ui:composition>
</html>
